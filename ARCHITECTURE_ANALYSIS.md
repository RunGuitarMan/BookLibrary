# –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ BookLibrary

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–û–±–∑–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Å—Ç–µ–∫–∞](#–æ–±–∑–æ—Ä-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ-—Å—Ç–µ–∫–∞)
3. [–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è](#–∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-—Ä–µ—à–µ–Ω–∏—è)
4. [–ü–∞—Ç—Ç–µ—Ä–Ω—ã Domain-Driven Design](#–ø–∞—Ç—Ç–µ—Ä–Ω—ã-domain-driven-design)
5. [CQRS –∏ –º–µ–¥–∏–∞—Ç–æ—Ä](#cqrs-–∏-–º–µ–¥–∏–∞—Ç–æ—Ä)
6. [–†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö](#—Ä–∞–±–æ—Ç–∞-—Å-–±–∞–∑–æ–π-–¥–∞–Ω–Ω—ã—Ö)
7. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –¥–æ–º–µ–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫-–∏-–¥–æ–º–µ–Ω–Ω—ã–µ-–∏—Å–∫–ª—é—á–µ–Ω–∏—è)
8. [Observability –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#observability-–∏-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
9. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
10. [–í—ã–≤–æ–¥—ã](#–≤—ã–≤–æ–¥—ã)

---

## –í–≤–µ–¥–µ–Ω–∏–µ

BookLibrary ‚Äî —ç—Ç–æ –æ–±—Ä–∞–∑—Ü–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –±–∏–±–ª–∏–æ—Ç–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ enterprise-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ .NET 9. –ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–Ω–∏–≥–∞–º–∏ –∏ –∞–±–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤—ã–¥–∞—á–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–Ω–∏–≥.

**–ö–ª—é—á–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞:**
- Clean Architecture —Å —á—ë—Ç–∫–æ–π –∏–∑–æ–ª—è—Ü–∏–µ–π —Å–ª–æ—ë–≤
- Domain-Driven Design (DDD) —Å –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏, value objects –∏ –¥–æ–º–µ–Ω–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏
- CQRS –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- Vertical Slices Architecture –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–∏—á–µ–π
- Railway-Oriented Programming —á–µ—Ä–µ–∑ Result<T>
- Outbox Pattern –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

---

## –û–±–∑–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Å—Ç–µ–∫–∞

### –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏
- **.NET 9.0** (–ø–æ—Å–ª–µ–¥–Ω—è—è LTS –≤–µ—Ä—Å–∏—è) —Å C# 13.0
- **ASP.NET Core** –¥–ª—è –≤–µ–±-API
- **Entity Framework Core 9.0.4** —Å PostgreSQL
- **Npgsql 9.0.4** ‚Äî –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–∞–Ω–Ω—ã—Ö PostgreSQL

### –ö–ª—é—á–µ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

#### Domain-Driven Design
- **FluentResults 3.16.0** ‚Äî Result<T> —Ç–∏–ø—ã –¥–ª—è Railway-Oriented Programming
- **StronglyTypedId** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- **Sstv.DomainExceptions** ‚Äî –¥–æ–º–µ–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å –∫–æ–¥–∞–º–∏ –æ—à–∏–±–æ–∫ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

#### CQRS –∏ –º–µ–¥–∏–∞—Ü–∏—è
- **Mediator 2.1.7** ‚Äî source-generated –º–µ–¥–∏–∞—Ç–æ—Ä –¥–ª—è CQRS (–±–µ–∑ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ)

#### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
- **Sstv.Outbox.EntityFrameworkCore.Npgsql** ‚Äî Transactional Outbox Pattern

#### –í–∞–ª–∏–¥–∞—Ü–∏—è
- **FluentValidation.AspNetCore 11.3.0** ‚Äî –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

#### Observability
- **Serilog.AspNetCore 9.0.0** ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **OpenTelemetry 1.12.0**:
  - Instrumentation –¥–ª—è ASP.NET Core, EF Core, HTTP, Runtime
  - Prometheus exporter –¥–ª—è –º–µ—Ç—Ä–∏–∫
  - OTLP exporter –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **NUnit 4.3.2**
- **ArchUnitNET 0.11.4** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

---

## –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. üéØ Vertical Slices Architecture

**–û–ø–∏—Å–∞–Ω–∏–µ**: –í–º–µ—Å—Ç–æ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (Controllers/, Services/, Repositories/), –∫–æ–¥ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–º —Å—Ä–µ–∑–∞–º ‚Äî –∫–∞–∂–¥–∞—è —Ñ–∏—á–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø–∞–ø–∫–µ —Å–æ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
Application/Features/
‚îú‚îÄ‚îÄ Books/
‚îÇ   ‚îú‚îÄ‚îÄ AddNewBook/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddNewBookCommand.cs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AddNewBookUseCase.cs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AddNewBookCommandValidator.cs
‚îÇ   ‚îú‚îÄ‚îÄ BorrowBook/
‚îÇ   ‚îú‚îÄ‚îÄ ReturnBook/
‚îÇ   ‚îú‚îÄ‚îÄ GetBook/
‚îÇ   ‚îî‚îÄ‚îÄ ServiceCollectionExtensions.cs  # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö use-case –∫–Ω–∏–≥
‚îú‚îÄ‚îÄ Abonents/
‚îÇ   ‚îú‚îÄ‚îÄ RegisterAbonent/
‚îÇ   ‚îî‚îÄ‚îÄ ServiceCollectionExtensions.cs
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- **–í—ã—Å–æ–∫–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å**: –í—Å—ë, —á—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –æ–¥–Ω–æ–π —Ñ–∏—á–∏, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- **–ù–∏–∑–∫–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å**: –§–∏—á–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏**: –ù–µ –Ω—É–∂–Ω–æ –ø—Ä—ã–≥–∞—Ç—å –º–µ–∂–¥—É —Å–ª–æ—è–º–∏
- **–õ–µ–≥–∫–æ —É–¥–∞–ª—è—Ç—å**: –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∏—á–∏ = —É–¥–∞–ª–µ–Ω–∏–µ –ø–∞–ø–∫–∏

**–ö–æ–¥ –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞** (`Books/ServiceCollectionExtensions.cs`):
```csharp
public static IServiceCollection AddBooksFeatures(this IServiceCollection services)
{
    return services
        .AddScoped<AddNewBookUseCase>()
        .AddScoped<BorrowBookUseCase>()
        .AddScoped<ReturnBookUseCase>()
        .AddScoped<GetBookUseCase>()
        .AddScoped<GetPagedBooksUseCase>()
        .AddScoped<GetBorrowedBooksUseCase>();
}
```

---

### 2. üß© –î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Å –º–µ—Ö–∞–Ω–∏–∑–º–æ–º —Ä–µ–¥—É–∫—Ü–∏–∏ (Domain Events Reducer)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –í–º–µ—Å—Ç–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π, –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **DomainEventsReducer**, –∫–æ—Ç–æ—Ä—ã–π –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ 100 —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –æ–¥–Ω–æ–π –∫–Ω–∏–≥–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è 100 —Å–æ–±—ã—Ç–∏–π `BookCreatedEvent`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫:
- 100 –≤—ã–∑–æ–≤–æ–≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –ò–∑–±—ã—Ç–æ—á–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –Ω–∞ –ë–î
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é –ª–æ–≥–æ–≤

**–†–µ—à–µ–Ω–∏–µ** (`DomainEventsReducer.cs`):
```csharp
public IEnumerable<IDomainEvent> Reduce(IReadOnlyCollection<IDomainEvent> domainEvents)
{
    var bookCreatedEvents = new List<BookCreatedEvent>();

    foreach (var domainEvent in domainEvents)
    {
        if (domainEvent is BookCreatedEvent bookCreatedEvent)
            bookCreatedEvents.Add(bookCreatedEvent);
        else
            yield return domainEvent;
    }

    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ ISBN + –î–∞—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
    var groups = bookCreatedEvents.GroupBy(x =>
        new { x.Title, x.Isbn, x.PublicationDate });

    foreach (var group in groups)
    {
        // –û–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ —Å Count = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–∏–≥
        yield return new BookCreatedEvent(
            group.Key.Title,
            group.Key.Isbn,
            group.Key.PublicationDate,
            group.Count()  // 100 –≤–º–µ—Å—Ç–æ 100 —Å–æ–±—ã—Ç–∏–π!
        );
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: 100 —Å–æ–±—ã—Ç–∏–π ‚Üí 1 —Å–æ–±—ã—Ç–∏–µ —Å Count=100

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (`DomainEventDispatcher.cs:79`):
```csharp
var reducedDomainEvents = _domainEventsReducer.Reduce(domainEvents);

foreach (var domainEvent in reducedDomainEvents)
{
    await _mediator.Publish(domainEvent, ct);
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚ö° –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏
- üìä –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ —Ç–æ—á–Ω–µ–µ: "–°–æ–∑–¥–∞–Ω–æ 100 –∫–æ–ø–∏–π –∫–Ω–∏–≥–∏ X", –∞ –Ω–µ "100 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–Ω–∏–≥"
- üîç –ú–µ–Ω—å—à–µ –∑–∞–ø–∏—Å–µ–π –≤ –ª–æ–≥–∞—Ö
- üíæ –ú–µ–Ω—å—à–µ –∑–∞–ø–∏—Å–µ–π –≤ outbox

---

### 3. üîÑ Outbox Pattern –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–Ω–∏–≥

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Transactional Outbox Pattern –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è eventual consistency –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–Ω–∏–≥.

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```
Domain Event (BookCreated)
    ‚Üì
BookStatChangeWatcher (—Å–ª—É—à–∞—Ç–µ–ª—å)
    ‚Üì
BookStatChange (outbox item) ‚Üí –ë–î –≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    ‚Üì
Background Worker (Sstv.Outbox)
    ‚Üì
BookStatChangeApplier (batch handler)
    ‚Üì
BookStat (read model) ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```

**–ö–æ–¥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞** (`BookStatChangeWatcher.cs:179`):
```csharp
public ValueTask Handle(BookCreated notification, CancellationToken ct)
{
    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ outbox –≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —á—Ç–æ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–∏–≥–∏
    _ctx.BookStatChanges.Add(new BookStatChange
    {
        Id = _uuidGenerator.GenerateNew(),
        Isbn = notification.Book.Isbn,
        PublicationDate = notification.Book.PublicationDate,
        AvailableCount = 1,    // +1 –¥–æ—Å—Ç—É–ø–Ω–∞—è –∫–Ω–∏–≥–∞
        BorrowedCount = 0,
    });

    return ValueTask.CompletedTask;
}
```

**Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞** (`BookStatChangeApplier.cs:64`):
```csharp
public async Task<OutboxBatchResult> HandleAsync(
    IReadOnlyCollection<BookStatChange> items,
    OutboxOptions options,
    CancellationToken ct)
{
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ ISBN + –î–∞—Ç–∞
    var books = items
        .GroupBy(x => (x.Isbn, x.PublicationDate))
        .ToDictionary(x => x.Key, v => new BookStatChange
        {
            Isbn = v.Key.Isbn,
            PublicationDate = v.Key.PublicationDate,
            AvailableCount = v.Sum(x => x.AvailableCount),  // –°—É–º–º–∏—Ä—É–µ–º
            BorrowedCount = v.Sum(x => x.BorrowedCount),
        });

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –∏–ª–∏ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–µ
    // ...

    return OutboxBatchResult.FullyProcessed;
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å**: –°–æ–±—ã—Ç–∏–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚úÖ **At-least-once delivery**: Worker –ø–µ—Ä–µ–æ—Ç–ø—Ä–∞–≤–∏—Ç –ø—Ä–∏ —Å–±–æ–µ
- ‚úÖ **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –ë–∞—Ç—á-–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ë–∞—Ç—á–∏–Ω–≥ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

---

### 4. üèõÔ∏è Convention-based –º–∞–ø–ø–∏–Ω–≥ Value Objects –≤ Entity Framework

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ value objects –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è EF Core —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω–æ–π:
```csharp
builder.Property(x => x.BookId).HasConversion(new BookIdEfValueConverter());
builder.Property(x => x.Isbn).HasConversion(new IsbnEfValueConverter());
builder.Property(x => x.Title).HasConversion(new BookTitleEfValueConverter());
// ... –¥–µ—Å—è—Ç–∫–∏ —Å—Ç—Ä–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏
```

**–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–æ–≤ –ø–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—é –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è** (`ServiceCollectionExtensions.cs`):
```csharp
options.ReplaceService<IValueConverterSelector,
    ValueObjectsConverterSelectorByConvention>();
```

**–°–æ–≥–ª–∞—à–µ–Ω–∏–µ:**
- Value Object: `BookId`
- –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä: `BookId` + `EfValueConverter` = `BookIdEfValueConverter`

**–ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä** (`ValueObjectsConverterSelectorByConvention.cs`):
```csharp
public class ValueObjectsConverterSelectorByConvention : ValueConverterSelector
{
    public override IEnumerable<ValueConverterInfo> Select(Type modelClrType, ...)
    {
        // –ò—â–µ–º –∫–ª–∞—Å—Å {TypeName}EfValueConverter –≤ —Ç–æ–º –∂–µ assembly
        var converterType = modelClrType.Assembly
            .GetType($"{modelClrType.FullName}EfValueConverter");

        if (converterType != null)
        {
            yield return new ValueConverterInfo(
                modelClrType,
                converterType,
                ...
            );
        }

        // Fallback –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã
        foreach (var info in base.Select(modelClrType, ...))
            yield return info;
    }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üéØ –ù—É–ª–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è value objects
- üìè –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å: –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π VO ‚Üí —Å–æ–∑–¥–∞—ë–º –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä ‚Üí –≥–æ—Ç–æ–≤–æ
- üîí –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- üìñ –Ø–≤–Ω–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏

---

### 5. üõ§Ô∏è Railway-Oriented Programming —á–µ—Ä–µ–∑ Result&lt;T&gt;

**–û–ø–∏—Å–∞–Ω–∏–µ**: –í–º–µ—Å—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω Result –∏–∑ **FluentResults**.

**–ü—Ä–∏–º–µ—Ä –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏** (`Book.cs:108`):
```csharp
public Result Borrow(Abonement abonement, DateTimeOffset borrowedAt, DateOnly? returnBefore)
{
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–∏–æ–¥–∞
    if (DateOnly.FromDateTime(borrowedAt.Date) >= returnBeforeDate)
    {
        return ErrorCodes.InvalidBookBorrowingPeriod.ToDomainError();
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞: –∫–Ω–∏–≥–∞ —É–∂–µ –≤—ã–¥–∞–Ω–∞?
    if (BorrowInfo is not null)
    {
        return BorrowInfo.AbonentId != abonement.AbonentId
            ? ErrorCodes.BookAlreadyBorrowed.ToDomainError()
            : Result.Ok();  // –¢–æ—Ç –∂–µ –∞–±–æ–Ω–µ–Ω—Ç ‚Äî —É–∂–µ –≤—ã–¥–∞–Ω–æ
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞: —É –∞–±–æ–Ω–µ–Ω—Ç–∞ —É–∂–µ 3 –∫–Ω–∏–≥–∏?
    if (abonement.BorrowedBooksCount >= 3)
    {
        return ErrorCodes.TooManyBooksBorrowedAlready.ToDomainError();
    }

    // –£—Å–ø–µ—à–Ω–∞—è –≤—ã–¥–∞—á–∞
    BorrowInfo = new BorrowInfo(abonement.AbonentId, borrowedAt, returnBeforeDate);
    AddDomainEvent(new BookBorrowedEvent(...));

    return Result.Ok();
}
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ use-case** (`BorrowBookUseCase.cs`):
```csharp
var result = book.Borrow(abonement, command.BorrowedAt, command.ReturnBefore);

if (result.IsFailed)
{
    return result;  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É –±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
}

await _ctx.SaveChangesAsync(ct);
return Result.Ok();
```

**–ú–∞–ø–ø–∏–Ω–≥ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ** (`ApiController.cs`):
```csharp
public IActionResult Ok(ResultBase result)
{
    if (result is { IsFailed: true })
    {
        var error = result.Errors.First();

        if (error is DomainErrorResult domainError)
        {
            return new ErrorCodeProblemDetails(domainError).ToActionResult();
        }
    }

    return base.Ok();
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üö´ **–ù–µ—Ç try-catch** –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- üéØ **–Ø–≤–Ω—ã–µ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã**: `Result Borrow(...)` ‚Äî —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞
- üîÄ **–ö–æ–º–ø–æ–∑–∏—Ü–∏—è**: –ú–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å Result'—ã
- üêõ **–õ–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å**: –û—à–∏–±–∫–∏ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤

---

### 6. üîê Strongly Typed IDs —Å Source Generation

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **StronglyTypedId** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** (`BookId.cs`):
```csharp
[StronglyTypedId(generateJsonConverter: false)]
public partial struct BookId;
```

**–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –∫–æ–¥** (—É–ø—Ä–æ—â—ë–Ω–Ω–æ):
```csharp
public partial struct BookId : IEquatable<BookId>
{
    public Guid Value { get; }

    public BookId(Guid value) => Value = value;

    public static implicit operator Guid(BookId id) => id.Value;
    public static implicit operator BookId(Guid value) => new(value);

    public bool Equals(BookId other) => Value.Equals(other.Value);
    public override int GetHashCode() => Value.GetHashCode();
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```csharp
// –°–æ–∑–¥–∞–Ω–∏–µ
var bookId = new BookId(Guid.NewGuid());

// –ù–µ—è–≤–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
Guid guid = bookId;  // –†–∞–±–æ—Ç–∞–µ—Ç
BookId id = guid;    // –¢–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

// –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
void BorrowBook(BookId bookId, AbonentId abonentId) { }

BorrowBook(abonentId, bookId);  // ‚ùå –û—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏!
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üõ°Ô∏è **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–ø—É—Ç–∞—Ç—å BookId –∏ AbonentId
- ‚ö° **–ù—É–ª–µ–≤–æ–π overhead**: struct –±–µ–∑ boxing
- üèóÔ∏è **Source generation**: –ù–µ—Ç —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ –≤ runtime
- üìù **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: `BookId` vs `Guid` ‚Äî –Ω–∞–º–Ω–æ–≥–æ –ø–æ–Ω—è—Ç–Ω–µ–µ

---

### 7. üß™ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (ArchUnitNET)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç **–∞–≤—Ç–æ—Ç–µ—Å—Ç—ã –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**, –∫–æ—Ç–æ—Ä—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ Clean Architecture.

**–¢–µ—Å—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Domain —Å–ª–æ—è** (`DomainDepsTests.cs`):
```csharp
[Test]
public void Domain_Should_Not_DependOn_OuterLayers()
{
    Types().That().Are(ProjectAssemblies.DomainLayer)
        .Should()
        .OnlyDependOnTypesThat()
        .Are(
            Types().That()
                .Are(ProjectAssemblies.DomainLayer).Or()
                .ResideInNamespace("FluentResults").Or()
                .ResideInNamespace("System").Or()
                .ResideInNamespace("Seedwork").Or()
                .ResideInNamespace("Mediator")
        )
        .Check(ProjectAssemblies.Architecture);
}
```

**–¢–µ—Å—Ç –∏–∑–æ–ª—è—Ü–∏–∏ Application —Å–ª–æ—è** (`ApplicationDepsTests.cs`):
```csharp
[Test]
public void Application_Should_Not_DependOn_OuterLayers()
{
    Types().That().Are(ProjectAssemblies.ApplicationLayer)
        .Should()
        .NotDependOnAnyTypesThat()
        .ResideInAssembly(
            ProjectAssemblies.InfrastructureAssembly,
            ProjectAssemblies.ApiAssembly
        )
        .Check(ProjectAssemblies.Architecture);
}

[Test]
public void Application_Should_Not_DependOn_Frameworks()
{
    Types().That().Are(ProjectAssemblies.ApplicationLayer)
        .Should()
        .NotDependOnAnyTypesThat()
        .Are(ProjectAssemblies.FrameworkDependencies)  // ASP.NET, EF Core
        .Check(ProjectAssemblies.Architecture);
}
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- ‚úÖ Domain –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Infrastructure/Application/API
- ‚úÖ Application –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Infrastructure/API
- ‚úÖ Application –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ (ASP.NET, EF Core)
- ‚úÖ –í—Å–µ entities –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ –∫–ª–∞—Å—Å–∞
- ‚úÖ –í—Å–µ value objects –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç ValueObject
- ‚úÖ –í—Å–µ –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Ä–µ–∞–ª–∏–∑—É—é—Ç IDomainEvent

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üîí **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏**: CI —Å–ª–æ–º–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- üìö **–ñ–∏–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –¢–µ—Å—Ç—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- üë• **Onboarding**: –ù–æ–≤—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ –º–æ–≥—É—Ç —Å–ª—É—á–∞–π–Ω–æ –Ω–∞—Ä—É—à–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞
- üîß **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ –º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É

---

### 8. üìä Query Splitting –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è Cartesian Explosion

**–û–ø–∏—Å–∞–Ω–∏–µ**: EF Core –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **split queries** –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ JOIN.

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`ServiceCollectionExtensions.cs`):
```csharp
options.UseNpgsql(npgsqlDataSource, builder =>
{
    builder.UseQuerySplittingBehavior(QuerySplittingBehavior.SplitQuery);
})
```

**–ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º:**
```sql
-- –ë–µ–∑ split query: Cartesian product
SELECT b.*, a1.*, a2.*, a3.*
FROM books b
LEFT JOIN LATERAL jsonb_to_recordset(b.authors) AS a1(...)
LEFT JOIN LATERAL jsonb_to_recordset(b.authors) AS a2(...)
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: N –∫–Ω–∏–≥ √ó M –∞–≤—Ç–æ—Ä–æ–≤ = –æ–≥—Ä–æ–º–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç
```

**–†–µ—à–µ–Ω–∏–µ —Å–æ split queries:**
```sql
-- –ó–∞–ø—Ä–æ—Å 1: –ö–Ω–∏–≥–∏
SELECT * FROM books WHERE ...;

-- –ó–∞–ø—Ä–æ—Å 2: –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
SELECT * FROM ... WHERE book_id IN (...);
```

**Trade-offs:**
- ‚úÖ –ò–∑–±–µ–≥–∞–µ–º Cartesian explosion –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö —Å–≤—è–∑—è—Ö
- ‚úÖ –ú–µ–Ω—å—à–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- ‚úÖ –õ—É—á—à–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å JSONB –∫–æ–ª–æ–Ω–∫–∞–º–∏ (–º–∞—Å—Å–∏–≤ –∞–≤—Ç–æ—Ä–æ–≤)
- ‚ö†Ô∏è –ë–æ–ª—å—à–µ round-trips –∫ –ë–î
- ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–∞ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

---

### 9. üèóÔ∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Repository Pattern

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ–µ–∫—Ç **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏**, –∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Å `DbSet<T>` —á–µ—Ä–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é `IApplicationContext`.

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** (`IApplicationContext.cs`):
```csharp
public interface IApplicationContext
{
    DbSet<Abonent> Abonents { get; }
    DbSet<Book> Books { get; }
    DbSet<BookStat> BookStats { get; }

    Task<int> SaveChangesAsync(CancellationToken ct);
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ use-case** (`GetBookUseCase.cs`):
```csharp
public class GetBookUseCase
{
    private readonly IApplicationContext _ctx;

    public async Task<Result<BookDto>> ExecuteAsync(GetBookQuery query, CancellationToken ct)
    {
        var book = await _ctx.Books
            .TagWithFileMember()
            .Where(x => x.Id == query.BookId)
            .FirstOrDefaultAsync(ct);

        return book is null
            ? ErrorCodes.BookNotFound.ToDomainError<BookDto>()
            : Result.Ok(book.ToDto());
    }
}
```

**–ü–æ—á–µ–º—É –Ω–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤?**

1. **DbSet<T> —É–∂–µ —è–≤–ª—è–µ—Ç—Å—è Generic Repository**
   ```csharp
   // –ù–µ—Ç —Å–º—ã—Å–ª–∞ –¥–µ–ª–∞—Ç—å –æ–±—ë—Ä—Ç–∫—É
   interface IBookRepository
   {
       Task<Book?> FindByIdAsync(BookId id);
   }

   // –ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ –Ω–∞–ø—Ä—è–º—É—é
   await _ctx.Books.FirstOrDefaultAsync(x => x.Id == id);
   ```

2. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –Ω–µ —Å—Ç—Ä–∞–¥–∞–µ—Ç**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è `IApplicationContext`
   - –í —Ç–µ—Å—Ç–∞—Ö –º–æ–∂–Ω–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å InMemory –ë–î

3. **–ì–∏–±–∫–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤**
   ```csharp
   // –° —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º –ø—Ä–∏—à–ª–æ—Å—å –±—ã –¥–æ–±–∞–≤–ª—è—Ç—å –º–µ—Ç–æ–¥—ã
   Task<List<Book>> FindAvailableByIsbnAsync(Isbn isbn);
   Task<List<Book>> FindBorrowedByAbonentAsync(AbonentId id);

   // –ò–ª–∏ –¥–µ–ª–∞—Ç—å Specification Pattern (–µ—â—ë –±–æ–ª—å—à–µ –∫–æ–¥–∞)

   // –° DbSet –ø—Ä–æ—Å—Ç–æ –ø–∏—à–µ–º LINQ
   await _ctx.Books
       .Where(x => x.BorrowInfo == null && x.Isbn == isbn)
       .ToListAsync();
   ```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üìâ –ú–µ–Ω—å—à–µ –∫–æ–¥–∞
- üéØ –ü—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω–æ—Å—Ç—å
- üîß –ì–∏–±–∫–æ—Å—Ç—å –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

### 10. üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å LoggingScope

**–û–ø–∏—Å–∞–Ω–∏–µ**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –ø–æ–ª–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç** (`LoggingScope.cs`):
```csharp
public static class LoggingScope
{
    public static class User
    {
        public const string ID = "UserId";
        public const string NAME = "UserName";
    }

    public static class Book
    {
        public const string ID = "BookId";
        public const string ISBN = "ISBN";
        public const string TITLE = "Title";
        public const string PUBLICATION_DATE = "PublicationDate";
    }

    public static class Abonent
    {
        public const string ID = "AbonentId";
        public const string EMAIL = "Email";
    }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** (`AddNewBookUseCase.cs`):
```csharp
using var _ = _logger.BeginScope(new Dictionary<string, object?>
{
    [LoggingScope.Book.ISBN] = command.Isbn,
    [LoggingScope.Book.TITLE] = command.Title,
    [LoggingScope.Book.PUBLICATION_DATE] = command.PublicationDate.ToString(),
});

_logger.LogInformation("Adding {Count} books", command.Count);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ Serilog (JSON):**
```json
{
  "timestamp": "2025-01-15T10:30:00Z",
  "level": "Information",
  "message": "Adding 10 books",
  "ISBN": "978-5-17-983250-4",
  "Title": "Clean Architecture",
  "PublicationDate": "2017-09-10",
  "Count": 10
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üîç **–ï–¥–∏–Ω—ã–µ –ø–æ–ª—è** –≤–æ –≤—Å–µ—Ö –ª–æ–≥–∞—Ö
- üìä **–õ–µ–≥–∫–æ –ø–∞—Ä—Å–∏—Ç—å** –≤ Elastic/Loki/etc
- üéØ **–ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ** –≤ IDE
- üêõ **–ù–µ—Ç –æ–ø–µ—á–∞—Ç–æ–∫**: `LoggingScope.Book.ISBN` vs `"isbn"` vs `"ISBN"` vs `"Isbn"`

---

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã Domain-Driven Design

### –ê–≥—Ä–µ–≥–∞—Ç—ã

–ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–∞ –∞–≥—Ä–µ–≥–∞—Ç–∞:

#### 1. Book Aggregate (`Book.cs`)
**–ö–æ—Ä–Ω–µ–≤–∞—è —Å—É—â–Ω–æ—Å—Ç—å**: `Book`

**Value Objects:**
- `BookId` ‚Äî —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `BookTitle` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- `Isbn` ‚Äî ISBN —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Ñ–æ—Ä–º–∞—Ç–∞ (regex –¥–ª—è ISBN-10/13)
- `BookPublicationDate` ‚Äî –¥–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- `Author` ‚Äî —Å–ª–æ–∂–Ω—ã–π VO (–∏–º—è, —Ñ–∞–º–∏–ª–∏—è, –æ—Ç—á–µ—Å—Ç–≤–æ)
- `BorrowInfo` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–¥–∞—á–µ –∫–Ω–∏–≥–∏

**–ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞:**
- –ö–Ω–∏–≥–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞
- –û–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–Ω–∏–≥–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–¥–∞–Ω —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–º—É –∞–±–æ–Ω–µ–Ω—Ç—É
- –ü–µ—Ä–∏–æ–¥ –≤—ã–¥–∞—á–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî 30 –¥–Ω–µ–π
- –î–∞—Ç–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã –≤—ã–¥–∞—á–∏

**–î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:**
- `BookCreatedEvent` ‚Äî –∫–Ω–∏–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- `BookBorrowedEvent` ‚Äî –∫–Ω–∏–≥–∞ –≤—ã–¥–∞–Ω–∞
- `BookReturnedEvent` ‚Äî –∫–Ω–∏–≥–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞

**–ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è:**
```csharp
public sealed class Book : Entity
{
    // –í—Å–µ —Å–µ—Ç—Ç–µ—Ä—ã private!
    public BookId Id { get; private set; }
    public BookTitle Title { get; private set; }
    public BorrowInfo? BorrowInfo { get; private set; }

    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±–∏–∑–Ω–µ—Å-–º–µ—Ç–æ–¥—ã
    public Result Borrow(Abonement abonement, ...)
    {
        // –í–∞–ª–∏–¥–∞—Ü–∏—è + –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è + —Å–æ–±—ã—Ç–∏–µ
        if (BorrowInfo is not null)
            return ErrorCodes.BookAlreadyBorrowed.ToDomainError();

        BorrowInfo = new BorrowInfo(...);
        AddDomainEvent(new BookBorrowedEvent(...));
        return Result.Ok();
    }
}
```

#### 2. Abonent Aggregate (`Abonent.cs`)
**–ö–æ—Ä–Ω–µ–≤–∞—è —Å—É—â–Ω–æ—Å—Ç—å**: `Abonent`

**Value Objects:**
- `AbonentId` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `AbonentName` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–º—è (–∏–º—è, —Ñ–∞–º–∏–ª–∏—è)
- `Email` ‚Äî –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π email

**–î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:**
- `AbonentRegisteredEvent` ‚Äî –∞–±–æ–Ω–µ–Ω—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

### Domain Services

**Abonement** (`BookPublicationDate.cs:48`) ‚Äî –¥–æ–º–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–¥–∞—á–∏ –∫–Ω–∏–≥–∏ –∞–±–æ–Ω–µ–Ω—Ç—É.

```csharp
public sealed class Abonement : ValueObject
{
    public AbonentId AbonentId { get; }
    public int BorrowedBooksCount { get; }  // –°–∫–æ–ª—å–∫–æ –∫–Ω–∏–≥ —É–∂–µ –Ω–∞ —Ä—É–∫–∞—Ö

    public Abonement(AbonentId abonentId, int borrowedBooksCount)
    {
        if (abonentId == default)
            throw ErrorCodes.InvalidBorrowerAbonentId.ToException();

        if (borrowedBooksCount < 0)
            throw ErrorCodes.InvalidBorrowerBooksCount.ToException();

        AbonentId = abonentId;
        BorrowedBooksCount = borrowedBooksCount;
    }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```csharp
// –í use-case —Å–æ–∑–¥–∞—ë–º Abonement
var borrowedCount = await _ctx.Books
    .Where(x => x.BorrowInfo != null && x.BorrowInfo.AbonentId == command.AbonentId)
    .CountAsync();

var abonement = new Abonement(command.AbonentId, borrowedCount);

// –ü–µ—Ä–µ–¥–∞—ë–º –≤ –∞–≥—Ä–µ–≥–∞—Ç ‚Äî –æ–Ω –ø—Ä–æ–≤–µ—Ä–∏—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
var result = book.Borrow(abonement, command.BorrowedAt, command.ReturnBefore);
```

### Value Objects

**–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å** (`ValueObject.cs`):
```csharp
public abstract class ValueObject : IEquatable<ValueObject>
{
    // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    public bool Equals(ValueObject? other)
    {
        return other is not null &&
               GetEqualityComponents().SequenceEqual(other.GetEqualityComponents());
    }

    public override int GetHashCode()
    {
        var hash = new HashCode();
        foreach (var component in GetEqualityComponents())
            hash.Add(component);
        return hash.ToHashCode();
    }

    // –ö–∞–∂–¥—ã–π VO –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–≤–æ–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    protected abstract IEnumerable<object?> GetEqualityComponents();
}
```

**–ü—Ä–∏–º–µ—Ä: BorrowInfo** (`BorrowInfo.cs`):
```csharp
public sealed class BorrowInfo : ValueObject
{
    public AbonentId AbonentId { get; private set; }
    public DateTimeOffset BorrowedAt { get; private set; }
    public DateOnly ReturnBefore { get; private set; }

    protected override IEnumerable<object?> GetEqualityComponents()
    {
        yield return AbonentId.ToString();
        yield return BorrowedAt.ToString();
        yield return ReturnBefore.ToString();
    }
}
```

**Immutability:**
- –í—Å–µ —Å–µ—Ç—Ç–µ—Ä—ã `private set`
- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `internal` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∞–≥—Ä–µ–≥–∞—Ç–∞
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é, –∞ –Ω–µ –ø–æ —Å—Å—ã–ª–∫–µ

### –î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

**–ë–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** (`IDomainEvent.cs`):
```csharp
public interface IDomainEvent : INotification  // Mediator INotification
{
}
```

**–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ Entity** (`Entity.cs:33`):
```csharp
public abstract class Entity : IEntity
{
    private List<IDomainEvent>? _domainEvents;

    protected virtual void AddDomainEvent(IDomainEvent domainEvent)
    {
        _domainEvents ??= [];
        _domainEvents.Add(domainEvent);
    }

    public void ClearDomainEvents()
    {
        _domainEvents?.Clear();
    }
}
```

**–î–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è** (`DomainEventDispatcher.cs:58`):
```csharp
public async Task DispatchDomainEventsAsync(CancellationToken ct)
{
    while (HasUnpublishedDomainEvents())
    {
        // –°–æ–±–∏—Ä–∞–µ–º —Å–æ–±—ã—Ç–∏—è –∏–∑ –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –≤ ChangeTracker
        var entities = _dbContext.ChangeTracker
            .Entries<IEntity>()
            .Where(e => e.Entity.DomainEvents.Count > 0)
            .Select(e => e.Entity);

        var domainEvents = new List<IDomainEvent>();
        foreach (var entity in entities)
        {
            domainEvents.AddRange(entity.DomainEvents);
            entity.ClearDomainEvents();
        }

        // –†–µ–¥—É–∫—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
        var reducedEvents = _domainEventsReducer.Reduce(domainEvents);

        // –ü—É–±–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Mediator
        foreach (var domainEvent in reducedEvents)
        {
            await _mediator.Publish(domainEvent, ct);
        }
    }
}
```

**–í—ã–∑–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º** (`ApplicationContext.cs`):
```csharp
public override async Task<int> SaveChangesAsync(CancellationToken ct)
{
    // 1. –î–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏—è –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
    _domainEventDispatcher.SetDbContext(this);
    await _domainEventDispatcher.DispatchDomainEventsAsync(ct);

    // 2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ Mediator –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
    await _mediator.DispatchPostSaveNotificationsAsync(...);

    // 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
    return await base.SaveChangesAsync(ct);
}
```

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –°–æ–±—ã—Ç–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è **–≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**, —á—Ç–æ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ –°–æ–±—ã—Ç–∏—è –≤—Å–µ–≥–¥–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ë–î
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏/—Å–æ–±—ã—Ç–∏—è
- ‚úÖ –¶–∏–∫–ª –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏–∏ (`while`) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

---

## CQRS –∏ –º–µ–¥–∏–∞—Ç–æ—Ä

### Source-Generated Mediator

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É **Mediator** —Å source generation –≤–º–µ—Å—Ç–æ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏.

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:**
```csharp
services.AddMediator(o => o.ServiceLifetime = ServiceLifetime.Scoped);
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞:**
- –ü—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–ª–∞—Å—Å `Mediator`, –∫–æ—Ç–æ—Ä—ã–π –∑–Ω–∞–µ—Ç –æ–±–æ –≤—Å–µ—Ö handlers
- –ù–µ—Ç —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ –≤ runtime ‚Üí –±—ã—Å—Ç—Ä–µ–µ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Ahead-of-Time (AOT) –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

### Commands

**–ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã** (`BorrowBookCommand.cs`):
```csharp
public sealed record BorrowBookCommand(
    BookId BookId,
    AbonentId AbonentId,
    DateTimeOffset BorrowedAt,
    DateOnly? ReturnBefore
) : IRequest<Result>;
```

**Handler/Use-case** (`BorrowBookUseCase.cs`):
```csharp
public sealed class BorrowBookUseCase : IRequestHandler<BorrowBookCommand, Result>
{
    private readonly IApplicationContext _ctx;

    public async ValueTask<Result> Handle(BorrowBookCommand command, CancellationToken ct)
    {
        // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≥—Ä–µ–≥–∞—Ç–∞
        var book = await _ctx.Books
            .FirstOrDefaultAsync(x => x.Id == command.BookId, ct);

        if (book is null)
            return ErrorCodes.BookNotFound.ToDomainError();

        // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–±–æ–Ω–µ–Ω—Ç–∞
        var abonent = await _ctx.Abonents
            .FirstOrDefaultAsync(x => x.Id == command.AbonentId, ct);

        if (abonent is null)
            return ErrorCodes.AbonentNotFound.ToDomainError();

        // 3. –ü–æ–¥—Å—á—ë—Ç –≤—ã–¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥
        var borrowedCount = await _ctx.Books
            .CountAsync(x => x.BorrowInfo!.AbonentId == command.AbonentId, ct);

        // 4. –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–º–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
        var abonement = new Abonement(command.AbonentId, borrowedCount);

        // 5. –í—ã–∑–æ–≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
        var result = book.Borrow(abonement, command.BorrowedAt, command.ReturnBefore);

        if (result.IsFailed)
            return result;

        // 6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (—Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è)
        await _ctx.SaveChangesAsync(ct);

        return Result.Ok();
    }
}
```

### Queries

**Read Model** (`BookStat.cs`):
```csharp
public sealed class BookStat
{
    public string Isbn { get; set; }
    public DateOnly PublicationDate { get; set; }
    public string Title { get; set; }
    public string Authors { get; set; }
    public int AvailableCount { get; set; }  // –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
    public int BorrowedCount { get; set; }   // –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
}
```

**Query** (`GetPagedBooksQuery.cs`):
```csharp
public sealed record GetPagedBooksQuery(
    int Page,
    int PageSize,
    string? SearchTerm
) : IRequest<Result<PagedResult<BookStatDto>>>;
```

**Handler** (`GetPagedBooksUseCase.cs`):
```csharp
public async ValueTask<Result<PagedResult<BookStatDto>>> Handle(
    GetPagedBooksQuery query,
    CancellationToken ct)
{
    var queryable = _ctx.BookStats.AsQueryable();

    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
    if (!string.IsNullOrWhiteSpace(query.SearchTerm))
    {
        queryable = queryable.Where(x =>
            EF.Functions.ILike(x.Title, $"%{query.SearchTerm}%") ||
            EF.Functions.ILike(x.Authors, $"%{query.SearchTerm}%") ||
            EF.Functions.ILike(x.Isbn, $"%{query.SearchTerm}%")
        );
    }

    // –ü–æ–¥—Å—á—ë—Ç
    var totalCount = await queryable.CountAsync(ct);

    // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
    var items = await queryable
        .OrderBy(x => x.Title)
        .Skip((query.Page - 1) * query.PageSize)
        .Take(query.PageSize)
        .Select(x => new BookStatDto(...))
        .ToListAsync(ct);

    return Result.Ok(new PagedResult<BookStatDto>(items, totalCount, query.Page));
}
```

**–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ:**
- **Write Model** (Commands): `Book`, `Abonent` ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã
- **Read Model** (Queries): `BookStat` ‚Äî –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **Eventual Consistency**: `BookStat` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ Outbox

---

## –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Entity Framework

**DbContext** (`ApplicationContext.cs`):
```csharp
public sealed class ApplicationContext : DbContext, IApplicationContext
{
    public DbSet<Abonent> Abonents { get; set; }
    public DbSet<Book> Books { get; set; }
    public DbSet<BookStat> BookStats { get; set; }
    public DbSet<BookStatChange> BookStatChanges { get; set; }
}
```

**–û–ø—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
```csharp
options
    .UseNpgsql(npgsqlDataSource, builder =>
    {
        builder.UseQuerySplittingBehavior(QuerySplittingBehavior.SplitQuery);
    })
    .UseSnakeCaseNamingConvention()  // camelCase ‚Üí snake_case
    .UseExceptionProcessor()  // –û–±—Ä–∞–±–æ—Ç–∫–∞ PostgreSQL –∏—Å–∫–ª—é—á–µ–Ω–∏–π
    .ReplaceService<IValueConverterSelector, ValueObjectsConverterSelectorByConvention>();
```

### Fluent Configuration

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Book** (`BookConfiguration.cs`):
```csharp
public class BookConfiguration : IEntityTypeConfiguration<Book>
{
    public void Configure(EntityTypeBuilder<Book> builder)
    {
        builder.HasKey(x => x.Id);

        // –ò–Ω–¥–µ–∫—Å –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–∑–¥–∞–Ω–∏—è
        builder.HasIndex(x => new { x.Isbn, x.PublicationDate });

        // JSON —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –∞–≤—Ç–æ—Ä–æ–≤
        builder.Property(x => x.Authors)
            .HasJsonConversion();

        // Owned Entity –¥–ª—è BorrowInfo
        builder.OwnsOne(x => x.BorrowInfo, y =>
        {
            y.Property(x => x.AbonentId)
                .HasColumnName("borrowed_by_abonent_id");
            y.Property(x => x.BorrowedAt)
                .HasColumnName("borrowed_at");
            y.Property(x => x.ReturnBefore)
                .HasColumnName("borrowed_return_before");
        });
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î:**
```sql
CREATE TABLE books (
    id UUID PRIMARY KEY,
    title TEXT NOT NULL,
    isbn TEXT NOT NULL,
    publication_date DATE NOT NULL,
    authors JSONB NOT NULL,  -- [{"name": "Robert", "surname": "Martin"}]
    borrowed_by_abonent_id UUID NULL,
    borrowed_at TIMESTAMPTZ NULL,
    borrowed_return_before DATE NULL,
    created_at TIMESTAMPTZ NOT NULL
);

CREATE INDEX ix_books_isbn_publication_date
    ON books(isbn, publication_date);
```

### Value Converters

**–ü—Ä–∏–º–µ—Ä –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞** (`IsbnEfValueConverter.cs`):
```csharp
public class IsbnEfValueConverter : ValueConverter<Isbn, string>
{
    public IsbnEfValueConverter()
        : base(
            v => v.Value,           // Isbn ‚Üí string
            v => new Isbn(v)        // string ‚Üí Isbn
        )
    {
    }
}
```

### PostgreSQL-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ñ–∏—á–∏

**Full-text search:**
```csharp
// ILike –¥–ª—è case-insensitive –ø–æ–∏—Å–∫–∞
.Where(x => EF.Functions.ILike(x.Title, $"%{searchTerm}%"))
```

**JSONB –æ–ø–µ—Ä–∞—Ü–∏–∏:**
```csharp
// –•—Ä–∞–Ω–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –∞–≤—Ç–æ—Ä–æ–≤
builder.Property(x => x.Authors).HasJsonConversion();

// –í –ë–î: {"name": "...", "surname": "..."}[]
```

**–†–∞—Å—à–∏—Ä–µ–Ω–∏—è:**
```sql
CREATE EXTENSION IF NOT EXISTS pg_trgm;  -- Trigram –¥–ª—è –ø–æ–∏—Å–∫–∞
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏

**–ü–æ—Å–ª–µ–¥–Ω—è—è –º–∏–≥—Ä–∞—Ü–∏—è**: `20241205181929_UpgradeDotnet9`

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
```bash
dotnet ef migrations add MigrationName --project BookLibrary.Infrastructure
dotnet ef database update --project BookLibrary.Api
```

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –¥–æ–º–µ–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

### –°–∏—Å—Ç–µ–º–∞ –∫–æ–¥–æ–≤ –æ—à–∏–±–æ–∫

**Enum —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏** (`ErrorCodes.cs`):
```csharp
[ExceptionConfig(ClassName = "BookLibraryException")]
[ErrorDescription(Prefix = "BL", Level = Level.Medium)]
public enum ErrorCodes
{
    [ErrorDescription(Description = "Book already borrowed", Level = Level.Low)]
    BookAlreadyBorrowed = 13,

    [ErrorDescription(Description = "Too many books borrowed already", Level = Level.NotError)]
    TooManyBooksBorrowedAlready = 27,

    [ErrorDescription(Description = "Abonent not found", Level = Level.Low)]
    AbonentNotFound = 2,

    // ... –≤—Å–µ–≥–æ 34 –∫–æ–¥–∞
}
```

**–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ** (—á–µ—Ä–µ–∑ Sstv.DomainExceptions):
```csharp
public class BookLibraryException : Exception
{
    public string ErrorCode { get; }  // "BL0013"
    public string ErrorId { get; }     // UUID v7
    public Level Level { get; }

    public BookLibraryException(ErrorCodes code, ...)
    {
        ErrorCode = $"BL{(int)code:D4}";
        ErrorId = UuidV7.Generate().ToString();
        // ...
    }
}
```

### Extension –º–µ—Ç–æ–¥—ã

**–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ Result:**
```csharp
public static class ErrorCodesExtensions
{
    public static Result ToDomainError(this ErrorCodes errorCode)
    {
        return Result.Fail(new DomainErrorResult(errorCode));
    }

    public static Result<T> ToDomainError<T>(this ErrorCodes errorCode)
    {
        return Result.Fail<T>(new DomainErrorResult(errorCode));
    }

    public static BookLibraryException ToException(this ErrorCodes errorCode)
    {
        return new BookLibraryException(errorCode);
    }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```csharp
// –í –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ (Result)
if (book is null)
    return ErrorCodes.BookNotFound.ToDomainError();

// –í –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞–≥—Ä–µ–≥–∞—Ç–∞ (Exception)
if (authors.Count == 0)
    throw ErrorCodes.BookMustHaveAnAuthors.ToException();
```

### –ú–∞–ø–ø–∏–Ω–≥ –Ω–∞ HTTP —Å—Ç–∞—Ç—É—Å—ã

**ErrorCodeProblemDetails** (RFC 7807):
```csharp
public class ErrorCodeProblemDetails : ProblemDetails
{
    public ErrorCodeProblemDetails(DomainErrorResult error)
    {
        Status = MapToHttpStatus(error.ErrorCode);
        Title = error.Description;
        Detail = error.ErrorCode;
        Extensions["errorId"] = error.ErrorId;
        Extensions["errorCode"] = error.ErrorCode;
        Extensions["level"] = error.Level.ToString();
    }

    private static int MapToHttpStatus(string errorCode)
    {
        return errorCode switch
        {
            "BL0002" => 404,  // AbonentNotFound
            "BL0001" => 404,  // BookNotFound
            "BL0013" => 400,  // BookAlreadyBorrowed
            "BL0027" => 400,  // TooManyBooksBorrowedAlready
            _ => 500
        };
    }
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "status": 400,
  "title": "Book already borrowed",
  "detail": "BL0013",
  "errorId": "01936c8e-7e92-7b3a-8c1a-3f2e1d0c9b8a",
  "errorCode": "BL0013",
  "level": "Low"
}
```

---

## Observability –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### OpenTelemetry

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`ServiceCollectionExtensions.cs`):
```csharp
services.AddOpenTelemetry()
    .WithMetrics(metrics => metrics
        .AddRuntimeInstrumentation()
        .AddHttpClientInstrumentation()
        .AddAspNetCoreInstrumentation()
        .AddPrometheusExporter()
    )
    .WithTracing(tracing => tracing
        .AddAspNetCoreInstrumentation()
        .AddEntityFrameworkCoreInstrumentation()
        .AddHttpClientInstrumentation()
        .AddConsoleExporter()
    );
```

**–ß—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è:**
- üåê **HTTP –∑–∞–ø—Ä–æ—Å—ã**: latency, status codes, paths
- üíæ **EF Core queries**: SQL, duration, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- üîß **.NET Runtime**: GC, ThreadPool, Exceptions
- üìä **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏**: —Å—á—ë—Ç—á–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è/–≤—ã–¥–∞—á–∏ –∫–Ω–∏–≥

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å** (`IMetricCollector.cs`):
```csharp
public interface IMetricCollector
{
    void BooksCreated(int count);
    void BookBorrowed();
    void BookReturned();
    void AbonentRegistered();
}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ OpenTelemetry:**
```csharp
public class MetricCollector : IMetricCollector
{
    private readonly Counter<int> _booksCreatedCounter;
    private readonly Counter<int> _booksBorrowedCounter;

    public MetricCollector(IMeterFactory meterFactory)
    {
        var meter = meterFactory.Create("BookLibrary");
        _booksCreatedCounter = meter.CreateCounter<int>("books.created");
        _booksBorrowedCounter = meter.CreateCounter<int>("books.borrowed");
    }

    public void BooksCreated(int count) => _booksCreatedCounter.Add(count);
    public void BookBorrowed() => _booksBorrowedCounter.Add(1);
}
```

**Prometheus endpoint:** `/metrics`

**–ü—Ä–∏–º–µ—Ä –º–µ—Ç—Ä–∏–∫:**
```
# TYPE books_created_total counter
books_created_total 1543

# TYPE books_borrowed_total counter
books_borrowed_total 342

# TYPE http_server_request_duration_seconds histogram
http_server_request_duration_seconds_bucket{le="0.005"} 120
```

### Serilog

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`Program.cs`):
```csharp
Log.Logger = new LoggerConfiguration()
    .ReadFrom.Configuration(configuration)
    .Enrich.FromLogContext()
    .WriteTo.Console(new CompactJsonFormatter())
    .CreateLogger();
```

**–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤** (Compact JSON):
```json
{
  "@t": "2025-01-15T10:30:00.123Z",
  "@mt": "Book {Title} created with ISBN {ISBN}",
  "Title": "Clean Architecture",
  "ISBN": "978-0134494166",
  "BookId": "01936c8e-...",
  "SourceContext": "BookLibrary.Application.Features.Books.AddNewBook"
}
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### ArchUnitNET —Ç–µ—Å—Ç—ã

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
BookLibrary.ArchTests/
‚îú‚îÄ‚îÄ Domain/
‚îÇ   ‚îú‚îÄ‚îÄ DomainDepsTests.cs        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Domain —Å–ª–æ—è
‚îÇ   ‚îú‚îÄ‚îÄ EntitiesTests.cs          # –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è Entity
‚îÇ   ‚îú‚îÄ‚îÄ ValueObjectTests.cs       # –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è ValueObject
‚îÇ   ‚îú‚îÄ‚îÄ ErrorCodeTests.cs         # –í–∞–ª–∏–¥–∞—Ü–∏—è ErrorCodes
‚îÇ   ‚îî‚îÄ‚îÄ DomainEventTests.cs       # –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Å–æ–±—ã—Ç–∏–π
‚îú‚îÄ‚îÄ Application/
‚îÇ   ‚îú‚îÄ‚îÄ ApplicationDepsTests.cs   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Application
‚îÇ   ‚îî‚îÄ‚îÄ UseCaseRules.cs           # –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è use-cases
‚îî‚îÄ‚îÄ ProjectAssemblies.cs          # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è assembly
```

**–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª:**

**Entities –¥–æ–ª–∂–Ω—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç Entity:**
```csharp
[Test]
public void Entities_Should_Inherit_From_BaseEntity()
{
    Types().That()
        .AreAssignableTo(typeof(IEntity))
        .And().AreNot(typeof(Entity))
        .Should()
        .BeAssignableTo(typeof(Entity))
        .Check(ProjectAssemblies.Architecture);
}
```

**Value Objects –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å immutable:**
```csharp
[Test]
public void ValueObjects_Should_Be_Immutable()
{
    Types().That()
        .AreAssignableTo(typeof(ValueObject))
        .Should()
        .HavePropertySettersWithPrivateAccess()
        .Check(ProjectAssemblies.Architecture);
}
```

**Use-cases –¥–æ–ª–∂–Ω—ã –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ "UseCase":**
```csharp
[Test]
public void UseCases_Should_Have_UseCase_Suffix()
{
    Types().That()
        .ImplementInterface(typeof(IRequestHandler<,>))
        .Should()
        .HaveNameEndingWith("UseCase")
        .Check(ProjectAssemblies.Architecture);
}
```

---

## –í—ã–≤–æ–¥—ã

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **üèóÔ∏è –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
   - –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ—ë–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏
   - Domain –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
   - –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

2. **üì¶ Vertical Slices**
   - –í—ã—Å–æ–∫–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å –≤–Ω—É—Ç—Ä–∏ —Ñ–∏—á–∏
   - –ù–∏–∑–∫–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —Ñ–∏—á–∞–º–∏
   - –ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

3. **üéØ –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - Strongly Typed IDs –∏—Å–∫–ª—é—á–∞—é—Ç –æ—à–∏–±–∫–∏
   - Value Objects –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é
   - Railway-Oriented Programming –≤–º–µ—Å—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

4. **‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - Source-generated Mediator –±–µ–∑ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏
   - Query Splitting –∏–∑–±–µ–≥–∞–µ—Ç Cartesian explosion
   - Outbox Pattern —Å batch –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

5. **üîç Observability**
   - OpenTelemetry –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –∏ –º–µ—Ç—Ä–∏–∫
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Serilog
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –ª–æ–≥–æ–≤

6. **üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**
   - ArchUnitNET –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
   - –ê–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
   - Domain-–ª–æ–≥–∏–∫—É –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –ë–î

### –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

1. **üìä CQRS –º–æ–∂–Ω–æ —Ä–∞–∑–≤–∏—Ç—å**
   - –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é read-only –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, Elasticsearch)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å projections –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

2. **üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
   - –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è mock
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å OAuth2/OIDC

3. **üìù –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π**
   - TODO –≤ –∫–æ–¥–µ: –∏—Å—Ç–æ—Ä–∏—è –≤—ã–¥–∞—á –∫–Ω–∏–≥ (Book.cs:162)
   - Event Sourcing –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞

4. **üöÄ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –î–æ–±–∞–≤–∏—Ç—å Redis –¥–ª—è –∫—ç—à–∞ read-–º–æ–¥–µ–ª–µ–π
   - Invalidation —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:
- ‚úÖ Clean Architecture –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ
- ‚úÖ Domain-Driven Design —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏
- ‚úÖ CQRS –∏ Event-Driven Architecture
- ‚úÖ Railway-Oriented Programming
- ‚úÖ Source Generators –≤ .NET
- ‚úÖ OpenTelemetry –∏ observability
- ‚úÖ ArchUnitNET –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-01-15
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** .NET 9.0
**–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç:** 84d581c - "chore: update deps"
